<!doctype html>
<html lang="es">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<meta name="format-detection" content="telephone=no">
<style>
  :root{ --berry:#7c003d; }
  html,body{ margin:0; }
  body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; color:#111; background:#fff; }
  /* La pantalla de login debe poder desplazarse en móviles */
  #screen-login{ min-height:100dvh; overflow:auto; display:flex; }
  .container{ width:100%; max-width:720px; margin:0 auto; padding:16px; }
  .login-card{ background:#fff; border:1px solid #eee; border-radius:12px; padding:16px; }

  /* Formulario 100% ancho + alto de toque cómodo */
  label{ display:block; font-weight:600; font-size:14px; margin:12px 0 6px; }
  select, input{
    width:100%; height:48px; font-size:16px; /* 16px evita zoom de iOS */
    border:1px solid #ddd; border-radius:12px; padding:10px 12px; background:#fff;
    appearance:auto; -webkit-appearance:menulist;
  }
  /* Botón grande, berry + letras blancas */
  .btn{ width:100%; height:48px; border:none; border-radius:12px; background:var(--berry); color:#fff; font-weight:700; cursor:pointer; }

  /* Pequeñas utilidades */
  .small{ color:#555; font-size:12px; }
  .mt{ margin-top:12px; }
</style>
</head>
<body>
  <h1>Reviderm · Carga mensual (CSV)</h1>
  <p class="small">Sube archivos CSV. Pega tu <b>ADMIN_SECRET</b> para autorizar.</p>
  <div class="row">
    <input id="secret" placeholder="ADMIN_SECRET">
  </div>

  <div class="card">
    <h3>1) Asesoras</h3>
    <p class="small">CSV columnas: <code>region,local,name,dni</code>. El backend hashea el DNI por ti.</p>
    <input type="file" id="csv-advisors" accept=".csv">
    <button onclick="upload('advisors','csv-advisors')">Subir asesoras</button>
    <pre>region,local,name,dni
Lima,Jockey Plaza,Ana Perez,43388812
Lima,San Miguel,Raúl Gómez,45678901</pre>
  </div>

  <div class="card">
    <h3>2) Productos</h3>
    <p class="small">CSV columnas: <code>id,sku,name,category,subcategory,price</code></p>
    <input type="file" id="csv-products" accept=".csv">
    <button onclick="upload('products','csv-products')">Subir productos</button>
    <pre>id,sku,name,category,subcategory,price
sku123,123,Essential Clean,Essential,Limpieza,89.9
sku888,888,Intelligence Serum,Intelligence,Antiage,199</pre>
  </div>

  <div class="card">
    <h3>3) Objetivos del mes</h3>
    <p class="small">CSV columnas: <code>month,region,local,advisor_name,goal_units</code> (puedes omitir <code>advisor_name</code> para fijar por local o por región).</p>
    <input type="file" id="csv-goals" accept=".csv">
    <button onclick="upload('goals','csv-goals')">Subir objetivos</button>
    <pre>month,region,local,advisor_name,goal_units
2025-10,Lima,Jockey Plaza,Ana Perez,60
2025-10,Lima,San Miguel,,120
2025-10,Lima,,,100</pre>
  </div>

  <div class="card">
    <h3>4) Premios del mes</h3>
    <p class="small">CSV columnas: <code>month,threshold,label,value_pen</code></p>
    <input type="file" id="csv-rewards" accept=".csv">
    <button onclick="upload('rewards','csv-rewards')">Subir premios</button>
    <pre>month,threshold,label,value_pen
2025-10,20,Bono 1,50
2025-10,40,Bono 2,100
2025-10,60,Bono 3,200</pre>
  </div>

  <script>
    async function upload(type, inputId){
      const f = document.getElementById(inputId).files[0];
      if(!f){ alert("Selecciona un CSV"); return; }
      const secret = document.getElementById('secret').value.trim();
      if(!secret){ alert("Ingresa ADMIN_SECRET"); return; }
      const text = await f.text();
      const r = await fetch('/.netlify/functions/admin-import?type='+type, {
        method:'POST',
        headers: {'content-type':'text/csv','x-admin-secret': secret},
        body: text
      });
      const j = await r.json().catch(()=>({}));
      alert(JSON.stringify(j, null, 2));
    }
  </script>
</body>
</html>
